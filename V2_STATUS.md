# V2 시스템 현황 및 추가 작업

## 현재 상태 ✅

### 완료된 작업
1. **Gemini Structured Output 기반 V2 파이프라인 구현**
   - Pydantic v2 모델 구현
   - PDF 전처리 모듈
   - Gemini API 서비스
   - 배치 처리 시스템

2. **V2 데이터베이스 스키마**
   - Surrogate Key (decision_pk) 도입
   - 테이블: decisions_v2, actions_v2, laws_v2, action_law_map_v2
   - 법률 정규화 (117개 표준 법률)

3. **V2 API 엔드포인트**
   - `/api/v1/v2/decisions/` - 의결서 목록
   - `/api/v1/v2/decisions/stats/dashboard` - 대시보드 통계
   - `/api/v1/v2/decisions/{year}/{id}` - 의결서 상세
   - `/api/v1/v2/decisions/{year}/{id}/download` - PDF 다운로드

4. **프론트엔드 V2 연동**
   - api.ts 파일에서 V2 엔드포인트 사용하도록 수정
   - 대시보드, 검색, PDF 다운로드 모두 V2 API 사용

## 현재 데이터 상태

### V2 데이터베이스
- 의결서: 12개
- 조치: 41개  
- 법률: 8개
- 법률매핑: 48개

### 테스트 결과
- 10개 파일 처리 성공
- 평균 처리 시간: 11.21초/파일
- 100% 성공률

## 추가 작업 필요 사항

### 1. 전체 데이터 재추출 🔄
```bash
# 전체 데이터 처리 스크립트
python process_all_v2.py
```
- 예상 파일 수: 2,000+ (2021-2025년)
- 예상 소요 시간: 약 6-8시간
- API 할당량 고려: 일일 250-2500 요청 제한

### 2. 카테고리 데이터 보완
현재 V2 데이터에서 category_1, category_2가 null입니다. 
- Gemini 프롬프트 개선 필요
- 카테고리 분류 로직 추가

### 3. 검색 기능 V2 대응
- NL2SQL 엔진이 V2 스키마 사용하도록 수정
- 검색 서비스에서 V2 테이블 참조

### 4. 데이터 품질 개선
- 날짜 정보 정확도 향상
- 법률 매핑 정확도 개선
- 위반 내용 요약 품질 향상

### 5. 모니터링 및 로깅
- 처리 실패 케이스 추적
- API 사용량 모니터링
- 처리 시간 최적화

## 프론트엔드 확인 사항

### 변경된 응답 스키마
1. **decision_pk 필드 추가**
   - 기존: decision_year + decision_id로 식별
   - 변경: decision_pk가 주 식별자

2. **null 값 처리**
   - category_1, category_2가 null일 수 있음
   - 프론트엔드에서 기본값 처리 필요

### 테스트 필요 항목
- [ ] 대시보드 통계 표시
- [ ] 의결서 목록 페이지네이션
- [ ] 의결서 상세 페이지
- [ ] PDF 다운로드 기능
- [ ] 검색 기능 (V2 데이터 대상)

## 권장 진행 순서

1. **즉시 가능**: 프론트엔드 테스트 및 UI 조정
2. **단기 (1-2일)**: 
   - 카테고리 분류 로직 개선
   - 검색 기능 V2 대응
3. **중기 (1주일)**:
   - 전체 데이터 재추출
   - API 할당량에 따라 일일 배치 처리
4. **장기**: 
   - 데이터 품질 모니터링 시스템 구축
   - V1 데이터 마이그레이션 검토

## 주의사항

1. **API 할당량**: Gemini Free Tier는 일일 250-2500 요청 제한
2. **처리 시간**: 대량 처리 시 Rate Limiting (6초/요청) 적용
3. **트랜잭션**: SQLite 사용 시 동시성 제한 고려
4. **백업**: 전체 재추출 전 반드시 백업 수행